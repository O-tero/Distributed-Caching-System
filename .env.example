# ============================================================================
# DISTRIBUTED CACHING SYSTEM - BACKEND ENVIRONMENT CONFIGURATION
# ============================================================================

# ============================================================================
# POSTGRESQL DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection settings
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=cache_user
POSTGRES_PASSWORD=changeme_dev_only
POSTGRES_DB=distributed_cache

# Connection pool settings
POSTGRES_MAX_CONNECTIONS=20
POSTGRES_MIN_CONNECTIONS=5
POSTGRES_CONNECTION_TIMEOUT=10000
POSTGRES_IDLE_TIMEOUT=30000

# SSL mode (disable, allow, prefer, require, verify-ca, verify-full)
POSTGRES_SSL_MODE=disable

# Full connection URL (alternative to individual settings)
# DATABASE_URL=postgresql://cache_user:password@localhost:5432/distributed_cache?sslmode=disable

# ============================================================================
# REDIS CACHE CONFIGURATION
# ============================================================================

# Redis connection settings
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Redis Sentinel (for high availability)
# REDIS_SENTINEL_HOSTS=sentinel1:26379,sentinel2:26379
# REDIS_SENTINEL_MASTER=mymaster

# Redis Cluster mode
# REDIS_CLUSTER_NODES=node1:6379,node2:6379,node3:6379

# Memory management
REDIS_MAXMEMORY=512mb
REDIS_EVICTION_POLICY=volatile-lru

# Connection pool
REDIS_POOL_SIZE=10
REDIS_POOL_MIN_IDLE=2

# Timeouts (milliseconds)
REDIS_CONNECT_TIMEOUT=5000
REDIS_COMMAND_TIMEOUT=3000

# Full connection URL (alternative)
# REDIS_URL=redis://localhost:6379/0

# ============================================================================
# CACHE MANAGER SERVICE CONFIGURATION
# ============================================================================

# Service port
CACHE_MANAGER_PORT=9400

# L1 Cache (In-Memory) Settings
L1_CACHE_ENABLED=true
L1_CACHE_MAX_SIZE=10000
L1_CACHE_MAX_MEMORY_MB=256
L1_CACHE_DEFAULT_TTL=300
L1_CACHE_CLEANUP_INTERVAL=60

# L2 Cache (Redis) Settings
L2_CACHE_ENABLED=true
L2_CACHE_DEFAULT_TTL=3600
L2_CACHE_KEY_PREFIX=cache:
L2_CACHE_COMPRESSION_ENABLED=false
L2_CACHE_COMPRESSION_THRESHOLD=1024

# Cache Strategy
CACHE_EVICTION_POLICY=lru
CACHE_WRITE_THROUGH=true
CACHE_WRITE_BEHIND=false
CACHE_WRITE_BEHIND_BATCH_SIZE=100
CACHE_WRITE_BEHIND_INTERVAL=1000

# Cache Stampede Prevention
CACHE_STAMPEDE_PREVENTION=true
CACHE_STAMPEDE_LOCK_TIMEOUT=5000

# ============================================================================
# INVALIDATION SERVICE CONFIGURATION
# ============================================================================

INVALIDATION_PORT=9401

# Invalidation settings
INVALIDATION_BATCH_SIZE=1000
INVALIDATION_BATCH_TIMEOUT=100
INVALIDATION_MAX_PATTERN_MATCHES=10000
INVALIDATION_ASYNC_ENABLED=true

# Audit logging
INVALIDATION_AUDIT_ENABLED=true
INVALIDATION_AUDIT_DB=true
INVALIDATION_AUDIT_LOG_FILE=true

# ============================================================================
# WARMING SERVICE CONFIGURATION
# ============================================================================

WARMING_PORT=9402

# Warming settings
WARMING_ENABLED=true
WARMING_MAX_CONCURRENT_JOBS=5
WARMING_BATCH_SIZE=100
WARMING_RETRY_ATTEMPTS=3
WARMING_RETRY_DELAY=1000

# Scheduled warming
WARMING_SCHEDULER_ENABLED=true
WARMING_SCHEDULER_INTERVAL=60000

# Predictive warming (ML-based)
WARMING_PREDICTIVE_ENABLED=false
WARMING_PREDICTIVE_MODEL=ml_model/warming_predictor.joblib

# ============================================================================
# MONITORING SERVICE CONFIGURATION
# ============================================================================

MONITORING_PORT=9403

# Metrics collection
METRICS_COLLECTION_INTERVAL=5000
METRICS_RETENTION_SECONDS=604800
METRICS_AGGREGATION_WINDOW=60

# Prometheus export
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_PATH=/metrics

# Alerting
ALERTING_ENABLED=true
ALERTING_WEBHOOK_URL=
ALERTING_EMAIL_ENABLED=false
ALERTING_EMAIL_SMTP_HOST=
ALERTING_EMAIL_SMTP_PORT=587
ALERTING_EMAIL_FROM=alerts@cache-system.local
ALERTING_EMAIL_TO=admin@cache-system.local

# Alert thresholds
ALERT_HIT_RATE_THRESHOLD=0.7
ALERT_LATENCY_P95_THRESHOLD=100
ALERT_ERROR_RATE_THRESHOLD=0.05
ALERT_MEMORY_USAGE_THRESHOLD=0.9

# ============================================================================
# PUB/SUB CONFIGURATION
# ============================================================================

# Pub/Sub provider (redis, kafka, nats)
PUBSUB_PROVIDER=redis

# Redis Pub/Sub settings
PUBSUB_REDIS_HOST=${REDIS_HOST}
PUBSUB_REDIS_PORT=${REDIS_PORT}
PUBSUB_REDIS_PASSWORD=${REDIS_PASSWORD}

# Kafka settings (if using Kafka)
# PUBSUB_KAFKA_BROKERS=kafka1:9092,kafka2:9092
# PUBSUB_KAFKA_CLIENT_ID=cache-system
# PUBSUB_KAFKA_GROUP_ID=cache-system-group

# NATS settings (if using NATS)
# PUBSUB_NATS_URL=nats://localhost:4222

# Event topics
TOPIC_CACHE_INVALIDATE=cache.invalidate
TOPIC_CACHE_REFRESH=cache.refresh
TOPIC_CACHE_WARM_COMPLETED=cache.warm.completed

# ============================================================================
# RATE LIMITING
# ============================================================================

# Global rate limits
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_SECOND=1000
RATE_LIMIT_BURST=2000

# Per-user/IP rate limits
RATE_LIMIT_PER_USER_ENABLED=true
RATE_LIMIT_PER_USER_RPS=100
RATE_LIMIT_PER_USER_BURST=200

# Per-endpoint rate limits
RATE_LIMIT_INVALIDATE_RPS=50
RATE_LIMIT_WARMING_RPS=10

# ============================================================================
# AUTHENTICATION & AUTHORIZATION
# ============================================================================

# Authentication method (token, jwt, oauth2, none)
AUTH_METHOD=token

# API token for development (generate secure tokens for production)
# Generate with: openssl rand -hex 32
API_TOKEN_ADMIN=dev_admin_token_change_me_in_production
API_TOKEN_SERVICE=dev_service_token_change_me_in_production

# JWT settings (if using JWT)
JWT_SECRET=change_me_in_production_use_long_random_string
JWT_EXPIRY_HOURS=24
JWT_ISSUER=cache-system
JWT_ALGORITHM=HS256

# OAuth2 settings (if using OAuth2)
# OAUTH2_PROVIDER=google
# OAUTH2_CLIENT_ID=
# OAUTH2_CLIENT_SECRET=
# OAUTH2_CALLBACK_URL=http://localhost:9400/auth/callback

# API Key rotation
API_KEY_ROTATION_DAYS=90

# ============================================================================
# CORS & SECURITY
# ============================================================================

# CORS configuration
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:9400
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Request-ID
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=86400

# Security headers
SECURITY_HEADERS_ENABLED=true
SECURITY_HSTS_ENABLED=false
SECURITY_HSTS_MAX_AGE=31536000

# TLS/SSL settings
TLS_ENABLED=false
TLS_CERT_FILE=/path/to/cert.pem
TLS_KEY_FILE=/path/to/key.pem
TLS_MIN_VERSION=1.2

# ============================================================================
# LOGGING
# ============================================================================

# Log level (debug, info, warn, error)
LOG_LEVEL=info

# Log format (json, text)
LOG_FORMAT=json

# Log output (stdout, file, both)
LOG_OUTPUT=stdout

# Log file settings (if LOG_OUTPUT includes file)
LOG_FILE_PATH=logs/cache-system.log
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_MAX_AGE_DAYS=7
LOG_FILE_MAX_BACKUPS=5
LOG_FILE_COMPRESS=true

# Structured logging
LOG_REQUEST_LOGGING=true
LOG_RESPONSE_LOGGING=false
LOG_INCLUDE_STACK_TRACE=true

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Go runtime settings
GOMAXPROCS=0
GOGC=100

# Worker pools
WORKER_POOL_SIZE=10
WORKER_QUEUE_SIZE=1000

# Request timeouts (seconds)
REQUEST_TIMEOUT=30
SHUTDOWN_TIMEOUT=30

# Circuit breaker
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60
CIRCUIT_BREAKER_MAX_REQUESTS=3

# Bulkhead pattern
BULKHEAD_ENABLED=true
BULKHEAD_MAX_CONCURRENT=100

# ============================================================================
# DISTRIBUTED TRACING
# ============================================================================

# Tracing enabled
TRACING_ENABLED=false

# Jaeger tracing
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831
JAEGER_SAMPLER_TYPE=probabilistic
JAEGER_SAMPLER_PARAM=0.1

# OpenTelemetry
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
# OTEL_SERVICE_NAME=cache-system

# ============================================================================
# METRICS & MONITORING
# ============================================================================

# Metrics provider (prometheus, statsd, datadog)
METRICS_PROVIDER=prometheus

# StatsD settings
# STATSD_HOST=localhost
# STATSD_PORT=8125
# STATSD_PREFIX=cache_system

# DataDog settings
# DATADOG_API_KEY=
# DATADOG_APP_KEY=
# DATADOG_SITE=datadoghq.com

# ============================================================================
# HEALTH CHECKS
# ============================================================================

# Health check endpoints
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_PORT=9400

# Readiness check
READINESS_CHECK_ENABLED=true
READINESS_CHECK_PATH=/ready

# Liveness check
LIVENESS_CHECK_ENABLED=true
LIVENESS_CHECK_PATH=/live

# ============================================================================
# BACKUP & DISASTER RECOVERY
# ============================================================================

# Backup settings
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=7
BACKUP_STORAGE_PATH=/backups
BACKUP_COMPRESSION=true

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Feature toggles
FEATURE_CACHE_WARMING=true
FEATURE_PREDICTIVE_WARMING=false
FEATURE_DISTRIBUTED_CACHE=true
FEATURE_CACHE_COMPRESSION=false
FEATURE_ASYNC_INVALIDATION=true

# Experimental features
EXPERIMENTAL_FEATURES_ENABLED=false
EXPERIMENTAL_ML_WARMING=false
EXPERIMENTAL_ADAPTIVE_TTL=false

# ============================================================================
# ENVIRONMENT INFORMATION
# ============================================================================

# Environment name
ENVIRONMENT=development

# Application version (auto-populated by CI/CD)
APP_VERSION=1.0.0

# Build information
BUILD_TIME=
GIT_COMMIT=
GIT_BRANCH=

# ============================================================================
# NOTES
# ============================================================================
#
# Security Best Practices:
# 1. Generate strong random passwords: openssl rand -base64 32
# 2. Use secrets management (HashiCorp Vault, AWS Secrets Manager)
# 3. Rotate credentials regularly
# 4. Enable TLS in production
# 5. Use strong JWT secrets
# 6. Implement network isolation
# 7. Enable audit logging
# 8. Monitor for suspicious activity
#
# Performance Tips:
# 1. Tune connection pools based on load
# 2. Adjust cache sizes based on available memory
# 3. Monitor hit rates and adjust TTLs
# 4. Enable compression for large payloads
# 5. Use async operations where possible
# 6. Profile and optimize hot paths
#
# High Availability:
# 1. Use Redis Sentinel or Cluster
# 2. Configure PostgreSQL replication
# 3. Enable circuit breakers
# 4. Implement graceful degradation
# 5. Use health checks in load balancers
# 6. Set up monitoring and alerting
#
# Troubleshooting:
# 1. Check logs: tail -f logs/cache-system.log
# 2. Verify connections: telnet localhost 5432
# 3. Test Redis: redis-cli ping
# 4. Check metrics: curl localhost:9090/metrics
# 5. Health check: curl localhost:9400/health